!function(e){"use strict";function t(){if(document.getElementById("moto-acquire-vvr-styles"))return;const e=document.createElement("style");e.id="moto-acquire-vvr-styles",e.textContent="#vvr-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:999998;opacity:0;visibility:hidden;transition:opacity .3s,visibility .3s}#vvr-drawer{position:fixed;top:0;width:600px;height:100%;background:#fff;z-index:999999;box-shadow:-2px 0 10px rgba(0,0,0,.3);transition:transform .3s;display:flex;flex-direction:column;overflow:hidden}#vvr-drawer.position-left{left:0;box-shadow:2px 0 10px rgba(0,0,0,.3);transform:translateX(-100%)}#vvr-drawer.position-right{right:0;transform:translateX(100%)}#vvr-close-button{position:absolute;top:10px;right:10px;background:0 0;border:0;font-size:24px;cursor:pointer;z-index:1000000;width:30px;height:30px;display:flex;align-items:center;justify-content:center;color:#666;border-radius:50%;transition:background-color .3s}#vvr-close-button:hover{background:#f5f5f5}#vvr-close-button:focus{outline:2px solid #007bff;outline-offset:2px}#vvr-drawer:focus{outline:0}#vvr-loading-spinner{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:10;width:40px;height:40px;border:4px solid rgba(0,0,0,.1);border-top:4px solid #007bff;border-radius:50%;animation:s 1s linear infinite;display:none}@keyframes s{0%{transform:translate(-50%,-50%) rotate(0)}100%{transform:translate(-50%,-50%) rotate(360deg)}}#vvr-drawer iframe{width:100%;height:calc(100% - 50px);border:0;margin-top:50px}@media (max-width:768px){#vvr-drawer{width:100%}#vvr-drawer.position-left{left:0;transform:translateX(-100%)}#vvr-drawer.position-right{right:0;transform:translateX(100%)}}@media (max-width:480px){#vvr-drawer{width:100vw;height:100vh;height:100dvh}#vvr-close-button{top:max(15px,env(safe-area-inset-top,0px) + 10px);right:max(15px,env(safe-area-inset-right,0px) + 10px);width:44px;height:44px;font-size:20px;background:rgba(0,0,0,.1);backdrop-filter:blur(4px)}#vvr-drawer iframe{margin-top:max(60px,env(safe-area-inset-top,0px) + 50px);height:calc(100% - max(60px,env(safe-area-inset-top,0px) + 50px) - env(safe-area-inset-bottom,0px))}}@media (max-width:896px) and (max-height:414px) and (orientation:landscape){#vvr-drawer{width:70%;max-width:600px}#vvr-drawer.position-left{left:0;transform:translateX(-100%)}#vvr-drawer.position-right{right:0;transform:translateX(100%)}}@media (max-width:360px){#vvr-close-button{top:max(10px,env(safe-area-inset-top,0px) + 5px);right:max(10px,env(safe-area-inset-right,0px) + 5px);width:40px;height:40px;font-size:18px}}@media (prefers-contrast:high){#vvr-overlay{background:rgba(0,0,0,.8)}#vvr-drawer{border:2px solid #000}#vvr-close-button{border:1px solid #000;background:#fff}}@media (prefers-reduced-motion:reduce){#vvr-overlay,#vvr-drawer,#vvr-close-button{transition:none!important}#vvr-loading-spinner{animation:none!important}}@media print{#vvr-overlay,#vvr-drawer{display:none!important}}",document.head.appendChild(e)}function i(e){return e?e.entityId?(e.baseUrl=e.baseUrl||"https://app.sellyourcar.online",e.position=e.position||"right",e.width=e.width||"600px",e.theme=e.theme||"auto",!0):(console.error('MotoAcquireVVRConfig: Missing required "entityId"'),!1):(console.error("MotoAcquireVVRConfig not found on window"),!1)}e.MotoAcquire||(e.MotoAcquire={}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t();class r{constructor(e){this.config=e,this.isOpen=!1,this.drawer=null,this.overlay=null,this.initialized=!1,this.iframe=null,this.resizeHandler=null,this.escapeHandler=null,this.previousFocusElement=null,this.needsTransitionSetup=!1}init(){if(this.initialized)return;this.overlay=document.createElement("div"),this.overlay.id="vvr-overlay",this.applyOverlayStyles(),this.drawer=document.createElement("div"),this.drawer.id="vvr-drawer",this.drawer.className="position-"+this.config.position,this.drawer.setAttribute("role","dialog"),this.drawer.setAttribute("aria-modal","true"),this.drawer.setAttribute("aria-labelledby","vvr-drawer-title"),this.drawer.setAttribute("tabindex","-1"),this.applyDrawerStyles();const e=document.createElement("button");e.id="vvr-close-button",e.innerHTML="Ã—",e.setAttribute("aria-label","Close vehicle valuation drawer"),this.applyCloseButtonStyles(e);const t=document.createElement("div");t.id="vvr-loading-spinner",t.setAttribute("aria-hidden","true"),this.applySpinnerStyles(t);const i=document.createElement("h1");i.id="vvr-drawer-title",i.innerHTML="Vehicle Valuation Report",i.style.position="absolute",i.style.left="-9999px",i.style.width="1px",i.style.height="1px",i.style.overflow="hidden",this.drawer.appendChild(i),this.drawer.appendChild(e),this.drawer.appendChild(t),document.body.appendChild(this.overlay),document.body.appendChild(this.drawer),this.attachEventListeners(e,t),this.attachResizeListener(),this.initialized=!0}applyOverlayStyles(){this.overlay.style.opacity="0",this.overlay.style.visibility="hidden";const e=window.matchMedia("(prefers-reduced-motion: reduce)").matches?"0s":"0.3s";this.overlay.style.transition=`opacity ${e} ease, visibility ${e} ease`}isMobileView(){return window.matchMedia("(max-width: 768px)").matches}updateDrawerWidth(){const e=this.isMobileView();this.drawer.style.width=e?"100%":this.config.width}updateDrawerPosition(){const e=window.matchMedia("(prefers-reduced-motion: reduce)");this.needsTransitionSetup?(this.needsTransitionSetup=!1,e.matches?this.drawer.style.transition="none":this.drawer.style.transition="transform 0.3s ease",this.drawer.offsetHeight,requestAnimationFrame(()=>{if(this.isOpen)this.drawer.style.transform="translateX(0)";else{const e="left"===this.config.position?"-100%":"100%";this.drawer.style.transform=`translateX(${e})`}})):(e.matches?this.drawer.style.transition="none":this.drawer.style.transition="transform 0.3s ease",requestAnimationFrame(()=>{if(this.isOpen)this.drawer.style.transform="translateX(0)";else{const e="left"===this.config.position?"-100%":"100%";this.drawer.style.transform=`translateX(${e})`}}))}applyDrawerStyles(){this.updateDrawerWidth(),this.drawer.style.transition="none";const e="left"===this.config.position?"-100%":"100%";this.drawer.style.transform=`translateX(${e})`,this.drawer.offsetHeight,this.needsTransitionSetup=!0}applyCloseButtonStyles(e){const t=window.matchMedia("(prefers-reduced-motion: reduce)").matches?"0s":"0.3s";e.style.transition=`background-color ${t} ease`}applySpinnerStyles(e){e.style.display="none",window.matchMedia("(prefers-reduced-motion: reduce)").matches&&(e.style.animation="none")}attachEventListeners(e,t){e.addEventListener("click",()=>this.close()),this.overlay.addEventListener("click",()=>this.close()),this.escapeHandler=e=>{"Escape"===e.key&&this.isOpen&&this.close()},document.addEventListener("keydown",this.escapeHandler);const i=new URL(this.config.baseUrl).origin;window.addEventListener("message",e=>{e.origin===i?"VALUATION_WIDGET_LOADED"===e.data.type&&(t.style.display="none"):console.warn("VVR Widget: Ignored message from untrusted origin:",e.origin,"Expected:",i)})}attachResizeListener(){this.resizeHandler&&window.removeEventListener("resize",this.resizeHandler),this.resizeHandler=()=>{this.drawer&&(this.updateDrawerWidth(),this.updateDrawerPosition())},window.addEventListener("resize",this.resizeHandler)}open(e){if(!this.isOpen){if(this.isOpen=!0,e&&(this.vehicleParams=e),this.previousFocusElement=document.activeElement,this.overlay.style.opacity="1",this.overlay.style.visibility="visible",this.updateDrawerPosition(),document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",!document.querySelector('meta[name="viewport"]')){const e=document.createElement("meta");e.name="viewport",e.content="width=device-width, initial-scale=1.0, viewport-fit=cover",document.head.appendChild(e)}setTimeout(()=>{this.drawer.focus()},100),this.loadReport()}}close(){this.isOpen&&(this.isOpen=!1,this.overlay.style.opacity="0",this.overlay.style.visibility="hidden",this.updateDrawerPosition(),document.body.style.overflow="",document.body.style.position="",document.body.style.width="",setTimeout(()=>{this.iframe&&this.drawer.contains(this.iframe)&&(this.drawer.removeChild(this.iframe),this.iframe=null)},300),this.previousFocusElement&&"function"==typeof this.previousFocusElement.focus&&this.previousFocusElement.focus(),this.resizeHandler&&(window.removeEventListener("resize",this.resizeHandler),this.resizeHandler=null),this.escapeHandler&&(document.removeEventListener("keydown",this.escapeHandler),this.escapeHandler=null))}loadReport(){const e=document.getElementById("vvr-loading-spinner");e&&(e.style.display="block"),this.iframe=document.createElement("iframe"),this.iframe.src=`${this.config.baseUrl}/api/vvr-widget?entityId=${encodeURIComponent(this.config.entityId)}`,this.iframe.setAttribute("title","Vehicle Valuation Report"),this.iframe.setAttribute("aria-describedby","vvr-drawer-title"),Object.assign(this.iframe.style,{width:"100%",height:"calc(100% - 50px)",border:"none",marginTop:"50px"}),this.iframe.onload=()=>{e&&(e.style.display="none")},this.iframe.onerror=()=>{e&&(e.style.display="none"),this.showError("Failed to load vehicle valuation. Please try again.")},this.drawer.appendChild(this.iframe)}showError(e){const t=document.createElement("div"),i=document.createElement("div");i.style.cssText="padding: 20px; text-align: center; color: #dc3545;";const r=document.createElement("h3");r.textContent="Error Loading Report";const o=document.createElement("p");o.textContent=e;const n=document.createElement("button");n.textContent="Close",n.style.cssText="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;",n.addEventListener("click",()=>{window.MotoAcquire.closeVVRDrawer()}),i.appendChild(r),i.appendChild(o),i.appendChild(n),t.appendChild(i),this.drawer.appendChild(t)}}e.MotoAcquire.openVVRDrawer=function(t){const o=e.MotoAcquireVVRConfig;if(i(o)){if(t){console.log("VVR Drawer - Vehicle Metadata:",JSON.stringify(t));const e=new URLSearchParams(t),i={vin:e.get("vin"),make:e.get("make"),model:e.get("model"),year:e.get("year"),trim:e.get("trim"),mileage:e.get("mileage")};console.log("VVR Drawer - Parsed Vehicle Data:",JSON.stringify(i))}e.MotoAcquire.drawerInstance||(e.MotoAcquire.drawerInstance=new r(o),e.MotoAcquire.drawerInstance.init()),e.MotoAcquire.drawerInstance.open(t)}},e.MotoAcquire.closeVVRDrawer=function(){e.MotoAcquire.drawerInstance&&e.MotoAcquire.drawerInstance.close()},e.MotoAcquire.getDrawerInstance=function(){return e.MotoAcquire.drawerInstance},e.MotoAcquire.VVRDrawer=r,e.MotoAcquire.validateConfig=i,e.MotoAcquire.drawerInstance=null,e.openVVRDrawer=e.MotoAcquire.openVVRDrawer,e.hasOwnProperty("vvrDrawerInstance")||Object.defineProperty(e,"vvrDrawerInstance",{get:function(){return e.MotoAcquire.drawerInstance},set:function(t){e.MotoAcquire.drawerInstance=t}}),function(){const t=document.querySelector("script[data-config-type]");t&&"dealer-dot-com"===t.getAttribute("data-config-type")?(e.MotoAcquireVVRConfig={entityId:t.getAttribute("data-entity-id"),baseUrl:t.getAttribute("data-base-url"),width:t.getAttribute("data-width"),configType:"dealer-dot-com"},e.DDC&&e.DDC.APILoader?e.DDC.APILoader.create("motoacquire").then(t=>{t.insertCallToAction("button","value-a-trade",t=>{const{vin:i,make:r,model:o,year:n,trim:a,mileage:s}=t;return{type:"default",href:"",text:{en_US:"Value My Trade",fr_CA:"Estimer ma reprise"},onclick:()=>{const t=new URLSearchParams({vin:i||"",make:r||"",model:o||"",year:n?.toString()||"",trim:a||"",mileage:s?.toString()||""}).toString();e.MotoAcquire.openVVRDrawer(t)}}})}).catch(t=>{console.error("Dealer.com integration failed:",t),e.MotoAcquire.drawerInstance&&e.MotoAcquire.drawerInstance.showError("Vehicle valuation failed to load or is currently unavailable. Please try again later.")}):console.warn("DDC.APILoader not available for Dealer.com integration")):e.MotoAcquireVVRConfig&&(e.MotoAcquireVVRConfig.configType="general")}();const o=new URLSearchParams(window.location.search),n=o.get("width");if(n&&window.MotoAcquireVVRConfig){const e=/^[\d.]+[a-z%]+$/i.test(n);window.MotoAcquireVVRConfig.width=e?n:`${n}px`}"open"===o.get("vvr")&&setTimeout(()=>{window.MotoAcquireVVRConfig&&window.openVVRDrawer()},100),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{console.log("MotoAcquire VVR Widget loaded")}):console.log("MotoAcquire VVR Widget loaded and namespaced")}(window);