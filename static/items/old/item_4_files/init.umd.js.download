(function(p,d){typeof exports=="object"&&typeof module<"u"?module.exports=d():typeof define=="function"&&define.amd?define(d):(p=typeof globalThis<"u"?globalThis:p||self,p.harmoniq=d())})(this,function(){"use strict";const p=t=>{let r={};return Object.keys(t).forEach(e=>{r[e]={partner:e,partnerProperties:t[e][e][0]}}),r},d=t=>{var a,n,s;const r=t.split(";"),e={},o=(s=(n=(a=t.split(";meta:"))==null?void 0:a[1])==null?void 0:n.split(";partnerCardOptions:{};"))==null?void 0:s[0];return r.forEach(c=>{const i=c.split(":");e[i[0]]=i.slice(1).join(":")}),{version:e.version,assetsDomain:e.assetsDomain,provider:e.provider,meta:JSON.parse(o||e.meta||"{}")}},A=async(t,r="nonprod")=>{try{if(!t)throw new Error("websiteId is required to fetch package version");const e=r==="nonprod"?"https://do-nonprod-site-api.azure-api.net/v1/api/harmoniq/data":"https://api.dealeron.com/api/harmoniq/data",o=t.startsWith("do-")?t.substring(3):t,a=`?_=${D(5)}`,n=await fetch(`${e}/${o}${a}`);if(!n.ok)throw new Error(`Error ${n.status}: cannot fetch package version`);return await n.json()}catch(e){return e instanceof Error&&console.error(e.message),null}},C=(t,r,e)=>{const o={},a=new URLSearchParams(window.location.search);if(a.get("harmoniqInit")==="true")return v(r);for(const[n,s]of Object.entries(r))for(const[c,i]of Object.entries(s))if(Object.keys(e).includes(c)&&(e[c]===!0||Array.isArray(e[c])&&e[c].includes(t))){if(a.get(c)==="false")continue;o[n]||(o[n]={}),o[n][c]=i}return v(o)},v=t=>{const r=new URLSearchParams(window.location.search);if(r.get("singlePackage")){const e=r.get("singlePackage");return e&&t[e]?{[e]:t[e]}:{}}for(const e of Object.values(t))for(const o of Object.keys(e))r.get(o)==="false"&&delete t[o];return t},b=(t,r,e,o)=>{const a=p(t);let n=JSON.stringify(a).replace(/"/g,"&quot;");const s=`version:partner-packages-${r};assetsDomain:${e}/partner-packages;provider:${o};meta:${JSON.stringify(a)};partnerCardOptions:{};`,i=`<section id="partner-card" style="display:none;" model="subject" basel="${`version:partner-packages-${r};assetsDomain:${e}/partner-packages;provider:${o};meta:${n};partnerCardOptions:{};`}"></section>`;document.body.insertAdjacentHTML("beforeend",i),window.Co||(window.Co={util:{options:{prototype:{parse:d}}}}),P(s,r,e)},P=(t,r,e)=>{const o=document.createElement("link");o.rel="stylesheet",o.href=`${e}/partner-packages/partner-packages-${r}/baselDeploy/master.css`,document.body.insertAdjacentElement("beforeend",o);const a=document.createElement("script");a.src=`${e}/partner-packages/partner-packages-${r}/baselDeploy/basel.js`,document.body.insertAdjacentElement("beforeend",a),a.onload=()=>{window.Basel.initBasel(),window.Basel.initPartnersMeta(d(t))}},D=(t=5)=>{const r=new Date,e=r.getMinutes(),o=Math.round(e/t)*t;return r.setMinutes(o,0,0),Math.floor(r.getTime()/1e3)},M=t=>t?/^\d+\.\d+\.\d+$/.test(t):!1,T=()=>{var a;let t;const r=document.querySelector("#dealeron_tagging_data");if(!r||!r.innerHTML){console.error("dealeron_tagging_data script not found.");return}try{const n=JSON.parse(r.innerHTML);t=(a=n==null?void 0:n.items)==null?void 0:a[0]}catch(n){console.error("Failed to parse JSON from dealeron_tagging_data:",n);return}if(!t){console.error("No VIN found in tagging data.");return}const{origin:e}=window.location,o=`${e}/routevin.aspx?vin=${encodeURIComponent(t)}`;window.location.href=o},V={partnerShowcase:!0,logRocket:!0,flickFusion:!0,letzChat:!0,kord:!0,bannerInSite:!0,vidcalls:!0,roadster:!0,lyteflo:!0,dgAutoNationServiceAppt:!0,askOtto:!0,digitalAirstrike:!0,xTimeModal:!0,eleads:["31418","31419","31933","29416"],edmunds:!0,phyron:!0,tvSquared:!0,carScore:!0,carScoreV2:!0,expressCTA:!0,netlook:!0,ftlaunchpadAiLptm:!0,dealerVision:!0,lectrium:!0,kenect:!0,ketch:!0,maxDigital:!0,offerLogix:!0,makeMyDeal:!0,recallMasters:!0,chargeway:!0,retailReady:!0,nexteppe:!0,concatSystems:!0,pureCars:!0,spinCar:!0,autoHook:!0,tikTok:!0,carNow:["30470","30625","30693","30345","30597","30675","30521","30441","30495","30431","30459","30492","30466","30430","30413","29718","29720","18761","5776","25834","19274","28361","24782","24798","24800","24802","24801","29681","26452","28876","28359","29674","28876","29645","28720","30164","30160","28671","29819","24782","28274","24797","15885","25329","25345","25330","25316","24808","21397","29812","28015","30126","24296","17379","24397","25626","25627","18761","29777","30256","12360","20375","30885","30892","30894","25733","27868","29731","30998","27843","26494","26032","29827","29817","26480","19667","23056","18420","22076","22751","5592","16060","25500","17982","17924","24631","19738","29673","29686","21864","13400","24402","26052","23029","27295","25686","16662","25738","18020","18428","18427","18426","18312","18408","18034","18409","18549","24589","17024"],webBuy:!0,joyDrive:!0,pureVin:!0,capitalOne:!0,perq:!0,accessiBe:!0,carGurus:!0,kbbico:!0,dasToolbar:!0,dealereProcess:!0,dealereProcessChat:!0,complyAuto:!0,captureWerks:!0,autosOnVideo:!0,podium:!0,driveItNow:!0,activEngage:!0,motoFuze:!0,wistiaChannels:!0,wistiaPlayers:!0,dealerYak:!0,dealerInspire:!0,tradePending:!0,darwinAutomotive:!0,autoLeadStar:!0,runMyLease:!0,clarivoy:!0,carFax:["30539","31617","30489","31689","30597","30662","30643","30611","30521","30384","30550","30515","30412","30479","30476","30554","28630","30891","16044","27232","14859","23271","20527","28561","31657","30646","28209","28337","26597","28643","31496","31801","31802","31802","31766","30716","30561","30542","30753","31661","30500","31802","31800","31874","25182"],carphoria:!0,liveEventStream:!0,autoipacket:!0,gubagoochat:["30539","31891","32087","31630","30616","31689","30724","30627","30617","30643","31727","30384","30735","30692","31855","29815","29816","31871","22524","16155","31362","31363","31331","17326","30278","22802","23701","28569","28962","29268","29999","29818","29809","30891","29242","29668","22909","28788","31027","27275","30787","27301","20785","27905","27390","29764","29814","27704","13691","30990","28070","24750","27095","30928","15065","30775","18801","19140","16856","30822","26478","29754","29815","31817","16170","31488","12508","12507","12510","9819","14433","30929","9790","25007","24998","24969","23163","30892","25209","30885","21326","31907","30654","30499","26360","30813","30622","31910","26534","31883","27304","29482","22853","30710","31883","31661","31950","24767","23226","25519","24989","24995","24990","26086","28569"],marketDoctor:!0,pureInfluencer:!0,aiSiteSmartServices:!0,recurrent:!0,vinIqAnalytics:!0,callRevu:!0,automotiveMastermind:!0,termly:!0,accuTrade:!0,trustap:!0,kbbtia:!0,Ignitify:["30333","30884","30645","31605","30957","30939","30935","30934","27704","13691","30215","16289","28341","24577","30770","30775","4974","30293","30893","26641","26644","26638","26642","26637","23735","23738","21696","25002","29303","12825","26527","29405","29203","21254","21268","30941","30938","30940","24509","31473","29189","28970","28946","28945","26846","28726","30946","31388","29764","29754","15427","26392","25008","30945","28801","23107","24822","24866","22488","23329","17368","26558","27343","27622","17007","27658","27621","27661","27657","27627","30162","30163","28487","27660","27688","28650","16830","16832","16829","16451","29195","27052","21577","21761","17917","14953","15857","16185","16255","18611","31883","31874"],"700credit":!0,googleTranslate:!0,tekionService:!0,tekionCredit:!0,tekion:!0,ddcPixall:!0,seezarAi:!0,autoFi:!0,sunbit:["31891","30625","30607","31354","15885","30940","30939","30945","30941","30938","30935","30934","30885","30892","27843","31338","31354","22561","22524","22527","22559","28625","28626","31032","28640","14406","4108","17526","30818","27299","14906","12310","12309","25734"],dealerSocket:!0,prodigy:["30405","30506","30248","4335","29656","19115","30259","30258","29377","13388","10787","23163","23122","21423","22363","24662","27638","11588","21062","16696","19404","28801","13624","30933","22759","19412","24046"],dealerImagePro:!0,drivably:!0,callRail:!0,velocityAutomotiveSolutions:!0,monroneyLabels:!0,ford:["17480","17811","15023","15520","13988","13999","13901","15275","14640","13993","13989","13899","14641","17802","13998","24852","26114","14846","31343","24291","16163","31488","26728","26705","26734"],weglot:!0,deskingAi:!0,clear2Target:!0,kelleyBlueBook:!0,"360Spyne":!0,tecobi:!0,carCutter:!0,shiftDigitalVWAfterSales:!0,dealerRater:!0,microsoftClarity:!0,fourEyes:!0,dealerTeamwork:!0,doGoogleAdsEnhancedConversions:!0,matadorChat:!0,routeOne:!0,schemamarkupIogetStructuredData:!0,vinCue:!0,hammerWebChat:!0,captivatedworks:!0,carSaverNissan:["25462","19641","26645"],convertExperiments:!0,amazonpixel:["30323","28093","30126","27599","26508","26754","12162","4899","23722","25595","25589","10837","20483","26136","26137"],strolidChat:["26465","26353","21784","25819","31494","25752"],simpliFi:["31621","30357","18672","18585","18948","29049","15459","29019"],deepAutomotive:["31840","30699","31591","30476","27901","27899","27891","27887","22519","14176","21264","30982","29733","30753","28496","31997","12569"],turboReferrals:!0,dealerMcDotCom:["30345","28455","30665"],autoHub:["30610","30152","31404","27083","24806","28967","27252","28426","29991","21542","11593","15070","30293","17609","17708","26423","17612","15696","31935","31899","25757"],smartPixl:["30466","28093","26998","26681","26828","11368","16696","20272","16696","23239","12723","31943","16780","26597"],facebooktracking:["31617","30498","31665","30625","31840","30617","30675","30640","30352","30612","31776","30699","31654","30522","30692","30481","22142","27951","30812","28521","28512","24704","24582","20604","30986","14392","24865","20786","28893","4408","16360","29411","18848","12929","27530","25754","25222","27877","23107","26239","22608","27591","27888","27353","27315","14197","13144","18533","28292","21386","28525","27588","24259","30248","25552","16832","28138","24826","24994","30711","24096","30462","30646","26523","28049","27592","28823","15070","11593","28418","18764","18610","30932","19793","14811","12366","31730","30700","30717","30613","30587","31599","30696","31723","30542","31908","10083","25424","18528","28070","27396","24296","31418","27107"],userWay:["26939","20811","31030"],redlineAdvantage:!0,trueFrame:!0,ladTech:["27843"],promax:["29416","30662","30612","31965","27843","29280","23790","25952","30744"],autoGenius:!0,autoCorp:!0,calenGrow:!0,dealerDna:!0,complynet:["30617","30476","27226","27143","26998","29383","24870","3174","25072","28464"],dealerFx:["30887","31980","30619","30675","30515","31605","27937","16714","18745","19041","25158","4878","18934","30646","31730","30613","31975","12507","6320","27607","28111"],glo3d:["28368","27055"],blinkAI:["25733","27843","19037","19793","24038","31030","20811","12310","12309","25734"],dealerFunnel:["25494","26303","28091","31906","31904"],flexpath:["30446","29418","15512"],adsrvr:["15397"],bingUET:["28877","28094","16740","30787"],textium:["30345","29348","17254","29993"],magicURL:["29348"],carSaverNissanV4:!0,greenmonkeyDroidAIPixel:!0,adsrvrV3:!0,mdhv:["30389","29718","29720"],iPredictive:["30645","27269","27352","30645","28551"],extremeReach:["30699","27269","30879","28971","27352","28730","28551"],dealerMade:!0,unityWorks:!0,buyerBridgeEventFlow:["28457","30945","29189","17966"],orbee:["30384","30575","28792","22183","13774","28269","28257","28255","26739","28260","28026"],dealerCentric:["17086","31661"],driveo:["16289","16021"],leadsRx:["15857","19500","23702"],localIQ:!0,audioEye:!0,mouseflow:!0,zmotAuto:!0,fixedOpsDigital:!0,carWars:!0,helloRamp:!0,clientConnexion:!0,nsightLive:["29204"],textingDealer:["27352"],selectFi:["21264"],adtaxi:!0,kbbLeadDriver:["31238","16849","23710","16143","29022","31871","30679","30500"],clientCommandAx5Pixel:!0,qoreAI:!0,carNowV2:!0,chat24:!0,intice:["28712"],magellanAiPixel:!0,liveAdmins:!0,dealerTrack:["31891","32011","30524","22561","22524","24323","22527","22559","30711","29022","30714","31971","30717","31920"],whatConverts:["29760"],coxCreditApp:!0,uniteDigitalEZTestDrive:!0,carfaxRatings:["30625","30675","29049","28445","28533"],autoDealReveal:!0,motoAcquire:!0,autoRaptor:!0,creditBureauConnection:!0,elfsightReviews:["16837"],conquestOne:["21464","11710"],octaneMarketing:["29009"],reunionMarketing:["20138"],blackWidow:["30637"],dmdt:!0,blackBook:!0,impelAIChat:!0,tpiImpact:["30462"],advantaStar:["30462"],googleTagManager:!1,optimy:["30628"],xandr:["18585","19716"],cdkCreditOnline:["27322"],dealerJazz:["30075"],adRollPixel:!0,pinterest:!0,adviserlyV2:!0,adviserly:!0,marchex:!0,timeHighway:!0,ifxAutopilot:!0,webTrackIQ:!0,simpSocial:!0,cartender:!0,carFilm:!0,eVePixel:!0,equalWeb:!0,knorex:!0,whispV2:!0,charterMedia:["27362","30716"],webLeads:["28179"],socialSignalBeacon:!0,starPerformanceMarketing:["24889"],floodlight:!0,behamics:!0,quotible:!0,intelliprice:!0,accreditapp:!0,myVehicleSite:!0,proMotionPix:!0,dealmatic:["19090","19035"],carvia:!0,carWise:["19160"],weDrive:["22237"],modalDriveMotors:!1,carouselFinance:!0},y=async()=>{var x,S;const t=document.querySelector('script[src*="harmoniq/init"]');if(!t)return;const r=new URLSearchParams(window.location.search),e=r.get("goToVDP")==="true",o=r.get("enablePartnerDemo");if(r.get("showPartners")==="false"||r.get("showVendors")==="false"||r.get("do_tpi")==="off"&&r.get("singlePackage")===null)return console.warn("Harmoniq: Kill switch is enabled, stopped loading Marketplace based installs.");e&&o&&T();const n=(x=t.getAttribute("src"))!=null&&x.includes("media.assets.dealeron.com")||(S=t.getAttribute("src"))!=null&&S.includes("media.assets.sincrod.com")?"prod":"nonprod",s=n==="prod"?"https://media.assets.dealeron.com":"https://media.assets-nonprod.dealeron.com",c=["data-website-provider","data-website-id"];let[i,l]=c.map(u=>t.getAttribute(u)),{packageVersion:m,manifestVersion:w,manifestContents:g}=await A(l,n)??{};const f=r.get("packageVersion");if(f&&M(f)&&(m=f),!m||!i||!l||!w)return console.error("Harmoniq: Missing required attributes");l.startsWith("do-")&&(l=l.replace("do-",""));try{let u,h=!g||g.length===0;if(!h)try{u=JSON.parse(g)}catch{h=!0}if(h&&(u=await(await fetch(`${s}/agency/iq-integration/installations/${l}/manifest_${w}.json`)).json()),!u)return console.error("Harmoniq: Manifest not found");const k=C(l,u,V);Object.keys(k).length>0&&b(k,m,s,i),r.get("harmoniqInit")==="true"&&Object.keys(k).length===0&&b(u,m,s,i)}catch(u){console.error("Harmoniq: error",u)}};return y(),y});
