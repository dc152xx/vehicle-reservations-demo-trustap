/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ 74173:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {


// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  w: () => (/* binding */ PriceAlertForm)
});

;// ./src/components/epricemodal/priceAlertService.ts
var __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
function submitForm(data) {
    return __awaiter(this, void 0, void 0, function* () {
        const payload = data;
        const formSubmissionEndpoint = `/api/vclwsaa/pricetracking/submit-price-alert/${data.dealerId}`;
        try {
            const response = yield fetch(formSubmissionEndpoint, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json; charset=utf-8",
                },
                body: JSON.stringify(payload),
            });
            if (response.ok) {
                return;
            }
            else if (response.status === 400) {
                const errors = yield response.json();
                if (!errors["Unknown"]) {
                    showValidationErrorsAlert(errors);
                    return;
                }
                else {
                    throw new Error(`Price Alert Form submission returned the following error message: ${errors.Unknown}`);
                }
            }
            throw new Error(`Form submission returned an unexpected status code: ${response.status}.`);
        }
        catch (err) {
            console.error("An error occurred while submitting the Price Alert form.", err);
        }
        finally {
            storeVinInLocalStorage(data.vin);
            emitPriceTrackEvent(data.vin);
        }
    });
}
function showValidationErrorsAlert(errors) {
    let msg = "Sorry, but the Price Alert form returned the following errors:";
    for (const fieldName in errors) {
        msg += `\n${fieldName}: ${errors[fieldName]}.`;
    }
    console.error(msg);
}
function emitPriceTrackEvent(vin) {
    const event = new CustomEvent("do-track-price", {
        detail: [
            {
                vin: vin,
                isTracking: true,
            },
        ],
    });
    window.dispatchEvent(event);
}
function storeVinInLocalStorage(vin) {
    const priceTrackVins = localStorage.getItem("do_price_track_vins");
    let vins = priceTrackVins ? JSON.parse(priceTrackVins) : [];
    if (vins.indexOf(vin) === -1) {
        vins.push(vin);
        localStorage.setItem("do_price_track_vins", JSON.stringify(vins));
    }
}

;// ./src/components/epricemodal/dealerUtils.ts
function getDealerId() {
    const doMetaDataScript = document.getElementById("dealeron_website_metadata");
    let dealerId = undefined;
    if (doMetaDataScript === null || doMetaDataScript === void 0 ? void 0 : doMetaDataScript.textContent) {
        try {
            const metadata = JSON.parse(doMetaDataScript.textContent);
            dealerId = metadata.dealerId
                ? parseInt(metadata.dealerId, 10)
                : undefined;
        }
        catch (e) {
            console.error("Error parsing dealer metadata", e);
        }
    }
    // Fallback to grabbing window object if needed
    if (!dealerId &&
        typeof window !== "undefined" &&
        window.DlronGlobal_DealerId) {
        dealerId = parseInt(window.DlronGlobal_DealerId, 10);
    }
    if (!dealerId) {
        return 0;
    }
    return dealerId;
}
function getSincroWebId() {
    var _a;
    const doMetaDataScript = document.getElementById("dealeron_website_metadata");
    let sincroWebId = undefined;
    if (doMetaDataScript === null || doMetaDataScript === void 0 ? void 0 : doMetaDataScript.textContent) {
        try {
            const metadata = JSON.parse(doMetaDataScript.textContent);
            sincroWebId = (_a = metadata.sincrowebId) !== null && _a !== void 0 ? _a : undefined;
            if (sincroWebId) {
                sincroWebId = String(sincroWebId);
            }
        }
        catch (e) {
            console.error("Error parsing dealer metadata for sincroWebId", e);
        }
    }
    return sincroWebId || "";
}
function getDealerAndSincroIds() {
    return { dealerId: getDealerId(), sincroWebId: getSincroWebId() };
}

;// ./src/components/epricemodal/priceAlertForm.ts
var priceAlertForm_awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};


class PriceAlertForm {
    constructor(form) {
        this.active = false;
        this.handleSubmit = (e) => priceAlertForm_awaiter(this, void 0, void 0, function* () {
            var _a, _b, _c, _d;
            e.preventDefault();
            if (!this.active)
                return;
            this.form._listenerAttached = false;
            // Always get the latest values
            const FirstName = ((_a = this.form.querySelector("#ePriceModalFirstName")) === null || _a === void 0 ? void 0 : _a.value) || "";
            const LastName = ((_b = this.form.querySelector("#ePriceModalLastName")) === null || _b === void 0 ? void 0 : _b.value) || "";
            const Email = ((_c = this.form.querySelector("#ePriceModalEmail")) === null || _c === void 0 ? void 0 : _c.value) ||
                "";
            const PhoneNumber = ((_d = this.form.querySelector("#ePriceModalPhone")) === null || _d === void 0 ? void 0 : _d.value) ||
                "";
            const SubmitBtn = this.form.querySelector("button[type='submit']");
            const Vin = this.form.getAttribute("data-vin") || "";
            //Removed salePrice since the Price Alert Service will determine the sales price
            const programSpecificData = {
                [Vin]: {
                    PRICEDROP: {},
                },
            };
            SubmitBtn === null || SubmitBtn === void 0 ? void 0 : SubmitBtn.setAttribute("disabled", "true");
            const { dealerId, sincroWebId } = getDealerAndSincroIds();
            const data = {
                dealerId: dealerId,
                vin: Vin,
                programDataGroupType: "VIN",
                firstName: FirstName,
                lastName: LastName,
                phoneNumber: PhoneNumber.replace(/\D/g, ""),
                email: Email,
                subscriptionTenant: sincroWebId,
                programSpecificData,
            };
            try {
                yield submitForm(data);
            }
            catch (error) {
                console.error("Submission failed:", error);
            }
            finally {
                SubmitBtn === null || SubmitBtn === void 0 ? void 0 : SubmitBtn.removeAttribute("disabled");
            }
        });
        if (!form)
            throw new Error("Form not found");
        this.form = form;
        this.ePriceModalDefaultDisclaimer = document.getElementById('defaultDisclaimer');
        this.form.addEventListener("submit", this.handleSubmit);
        this.originalFormName = this.form.dataset.dotaggingFormName || "";
        this.originalProductName = this.form.dataset.dotaggingProductName || "";
    }
    activate() {
        this.active = true;
        if (this.ePriceModalDefaultDisclaimer) {
            this.ePriceModalDefaultDisclaimer.style.fontSize = "16px";
            this.ePriceModalDefaultDisclaimer.style.paddingBottom = "10px";
        }
        this.form.dataset.dotaggingFormName = "Track Price";
        this.form.dataset.dotaggingProductName = "Track Price";
    }
    deactivate() {
        this.active = false;
        if (this.ePriceModalDefaultDisclaimer) {
            this.ePriceModalDefaultDisclaimer.style.removeProperty("font-size");
            this.ePriceModalDefaultDisclaimer.style.removeProperty("padding-bottom");
            this.ePriceModalDefaultDisclaimer.innerHTML = "";
        }
        this.form.dataset.dotaggingFormName = this.originalFormName;
        this.form.dataset.dotaggingProductName = this.originalProductName;
    }
    getDisclaimers() { return this.form.querySelectorAll(".form-group-disclaimers"); }
}


/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
/* unused harmony export EPriceModal */
/* harmony import */ var _priceAlertForm__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(74173);
var __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};

class EPriceModalSettings {
    constructor() {
    }
}
class ModalButtonConfig {
    constructor() {
        this.comments = "";
    }
}
class EPriceModalButtonConfig {
    constructor(data) {
        this.buttons = data;
    }
}
class EPriceModal {
    constructor() {
        this._mostRecentMode = "";
        this._mostRecentCPO = "";
        this._vehicleModelCode = "";
        this._legacyEPriceButtonConfig = null;
        this._setupComplete = false;
        this.onHideModalHandler = (e) => {
            var _a, _b;
            e.currentTarget.setAttribute('aria-hidden', true);
            document.getElementById('thankyou-popup').style.display = 'none';
            document.getElementById('eprice-main-content').style.display = 'block';
            (_a = document.getElementById('ePriceModalSubmitButton')) === null || _a === void 0 ? void 0 : _a.removeAttribute('disabled');
            (_b = this._priceAlertForm) === null || _b === void 0 ? void 0 : _b.deactivate();
            window.ePriceModal.teardownOneTimeLeadEvents();
        };
        this.onShowModalHandler = (e) => {
            var _a;
            const button = e.relatedTarget;
            this.trySetModalLabelsByAttribute(button);
            this.setupOneTimeLeadEvents();
            if (button.tagName.toLowerCase() === "do-price-track") {
                (_a = this._priceAlertForm) === null || _a === void 0 ? void 0 : _a.activate();
            }
        };
        this.getLeadSource = () => {
            const page = {
                isMobile: ('ontouchstart' in document.documentElement && navigator.userAgent.match(/Mobi/)),
                isSrp: this._settings.pageIsSrp,
                isVdp: this._settings.pageIsVdp,
                isMrp: this._settings.pageIsMrp,
                isNew: this._settings.pageIsNew,
            };
            const vehicle = {
                type: document.getElementById('eprice_vehType').innerHTML.trim().toLowerCase(),
                isCpo: function () { return typeof this.MostRecentCPO != 'undefined' && this.MostRecentCPO != null && this.MostRecentCPO.toLowerCase() === 'true'; },
            };
            /* Special ePrice cases */
            if (this._mostRecentMode === 'ReserveThisVehicle') {
                return this.getReserveThisVehicleLeadSource(page, vehicle);
            }
            if (this._mostRecentMode === 'PriceDropAlert' || this._mostRecentMode === 'TrackPrice') {
                return this.getPriceDropAndTrackAlertLeadSource(page, vehicle);
            }
            if (this._mostRecentMode === 'GetSalePrice') {
                return this.getGetSalePriceLeadSource(page, vehicle);
            }
            if (this._mostRecentMode === 'ConfirmAvailability') {
                return this.getConfirmAvailabilityLeadSource(page, vehicle);
            }
            if (this._mostRecentMode === 'PriceStakPayments') {
                return this.getPriceStakPaymentsLeadSource(page, vehicle);
            }
            /* Basic Vdp Or Srp Cases */
            if (page.isVdp) {
                return this.getVdpLeadSource(page, vehicle);
            }
            if (page.isMrp) {
                return this.getMrpLeadSource(page, vehicle);
            }
            else {
                return this.getSrpLeadSource(page, vehicle);
            }
        };
        this.getLeadType = () => {
            const type = document.getElementById('eprice_vehType').innerHTML.trim().toLowerCase();
            if (type === 'u') {
                return 2;
            }
            else if (type === 'n') {
                return 1;
            }
            else {
                return this._settings.pageLeadType;
            }
        };
        this.toggleIsEnabled = (toggle) => {
            let isEnabled = this.isToggleQueryParamOn(toggle);
            if (isEnabled !== null)
                return isEnabled;
            return this._toggles && this._toggles[toggle] === true;
        };
        this.ePriceData = () => {
            var _a, _b, _c, _d, _e;
            let comment = (_a = document.getElementById("ePriceModalComments")) === null || _a === void 0 ? void 0 : _a.value;
            const spinCarUserRef = window.spinCarUserReference;
            if (spinCarUserRef) {
                if ((typeof spinCarUserRef == "string") && spinCarUserRef.trim() != '') {
                    comment += ' SpinCar report: ' + spinCarUserRef;
                }
            }
            let optOut = window.jQuery('#optOut', '#epriceForm')[0];
            if (optOut) {
                comment += ', Do Not Sell Personal Info: ' + optOut.checked;
            }
            const vin = (_b = document.getElementById('eprice_vehVin')) === null || _b === void 0 ? void 0 : _b.innerHTML.trim();
            const vehicleId = (_c = document.getElementById('eprice_vehId')) === null || _c === void 0 ? void 0 : _c.innerHTML.trim();
            // if the location dropdown is there, we need to use its selection
            // otherwise we just use the value from the CTA data attribute
            let location = (_d = document.getElementById('eprice_vehLocation')) === null || _d === void 0 ? void 0 : _d.innerHTML.trim();
            let isChildDealer = false;
            let toggles = this.getLocalStorageToggles();
            const altDealerElem = document.querySelector("#selDealerEPriceModal");
            if (altDealerElem) {
                // name is set as "ChildDealerId" if SendLeadToChildSite customization is disabled
                // in this case, we send the location as ChildDealerId and add it to comments
                // otherwise, we send it as AltDealerId
                // In theory, this prevents the lead from being sent to the dealer chosen in the dropdown
                // see GroupDealerList.cs
                isChildDealer = altDealerElem.getAttribute("name") == "ChildDealerId";
                if (isChildDealer) {
                    var dealerName = altDealerElem.options[altDealerElem.selectedIndex].text;
                    var dealerId = altDealerElem.value;
                    comment += `${comment.length > 0 ? ', ' : ''}ChildDealerName: ${dealerName}, ChildDealerId: ${dealerId}`;
                }
                if (!this.toggleIsEnabled("AltDealerIdProtection_DO46595")) {
                    location = altDealerElem.value;
                }
                else { // toggle is true so we want to allow altDealerElem to set AltDealerId only if it's not ChildDealerId
                    if (!isChildDealer) {
                        location = altDealerElem.value;
                    }
                }
            }
            const toyotaEnhancedLeadForm = document.querySelectorAll('[data-toyota-enhanced-lead]');
            for (let i = 0; i < toyotaEnhancedLeadForm.length; i++) {
                const checkbox = toyotaEnhancedLeadForm[i];
                comment += checkbox.checked ? '\n' + toyotaEnhancedLeadForm[i].getAttribute('data-toyota-enhanced-lead') : '';
            }
            let result = {
                Comments: comment,
                VehicleModelCode: this._vehicleModelCode,
                VehicleId: vehicleId,
            };
            if (((_e = this._settings.vehicleType) === null || _e === void 0 ? void 0 : _e.toLowerCase()) !== "virtual") {
                result["Vin"] = vin;
                result["VehicleType"] = this._settings.vehicleType;
                if (!this.toggleIsEnabled("AltDealerIdProtection_DO46595")) {
                    if (isChildDealer) {
                        result["ChildDealerId"] = location;
                    }
                    else {
                        result["AltDealerId"] = location;
                    }
                }
                else {
                    if (isChildDealer) {
                        result["ChildDealerId"] = dealerId;
                    }
                    result["AltDealerId"] = location;
                }
            }
            //NOTE: See PriceModeEPriceConfiguration.cs
            if (this._settings.bodyCodeBottom) {
                eval(this._settings.bodyCodeBottom);
            }
            return result;
        };
        this.getSettings();
    }
    getSettings() {
        var jsonElement = document.getElementById('epriceModalSettings');
        const jsonText = jsonElement === null || jsonElement === void 0 ? void 0 : jsonElement.text;
        this._settings = jsonText == null ? {} : JSON.parse(jsonText);
        this._toggles = this.getLocalStorageToggles();
        const formElem = document.getElementById("epriceForm");
        if (formElem) {
            this._priceAlertForm = new _priceAlertForm__WEBPACK_IMPORTED_MODULE_0__/* .PriceAlertForm */ .w(formElem);
        }
    }
    init() {
        var modalConfig = document.getElementById("epriceModalConfig");
        const modalConfigText = modalConfig === null || modalConfig === void 0 ? void 0 : modalConfig.text;
        this._buttonConfig = modalConfigText == null ? new EPriceModalButtonConfig({}) : new EPriceModalButtonConfig(JSON.parse(modalConfigText));
        this.setupEvents();
        this.getLeadJsContent();
    }
    setupEvents() {
        var targets = ".reserveVehicleBtn, .btnPriceDropAlert, .btnNewPriceAlert, .confirmAvailabilityBtn, [data-eprice-modal-button]";
        if (this._settings.shouldDisplayEPrice || !this._settings.pageIsSrp) {
            targets += ", .ePriceBtn";
        }
        var targetElems = document.querySelectorAll(targets);
        targetElems.forEach((elem) => {
            //NOTE: Only wire up the event once per button
            if (!elem.dataset.epriceModalProcessed) {
                elem.dataset.epriceModalProcessed = 'true';
                elem.addEventListener("click", (e) => {
                    this.setupPrimaryButtonPageModal(e);
                });
            }
        });
        const closeButton = document.querySelector('.close');
        if (closeButton !== null && !closeButton.dataset.epriceModalProcessed) {
            closeButton.dataset.epriceModalProcessed = 'true';
            closeButton.addEventListener("click", () => {
                //Declared in various Tracker.cs
                window.ResetTracker();
            });
        }
        //NOTE: this is calling bootstrap events so we have to use jQuery
        //NOTE: use .off before on to prevent adding this multiple times
        window.jQuery('#primaryButtonPageModal').off('hide.bs.modal', this.onHideModalHandler);
        window.jQuery('#primaryButtonPageModal').on('hide.bs.modal', this.onHideModalHandler);
        //NOTE: Legacy pricestack custom buttons is below, this is the logic for current
        //      price stack. It uses data attributes set on the triggering
        //NOTE: use .off before on to prevent adding this multiple times
        window.jQuery('#primaryButtonPageModal').off('shown.bs.modal', this.onShowModalHandler);
        window.jQuery('#primaryButtonPageModal').on('shown.bs.modal', this.onShowModalHandler);
        // see DO-26059
        for (const primaryButton of Array.from(document.querySelectorAll("[id^=primaryButtonPageModalButton]"))) {
            const button = primaryButton;
            //NOTE: Only wire up the event once per button
            if (!button.dataset.epriceModalProcessed) {
                button.dataset.epriceModalProcessed = 'true';
                button.addEventListener("click", (e) => {
                    const trigger = e.currentTarget;
                    //NOTE: this is calling bootstrap events so we have to use jQuery
                    window.jQuery("#primaryButtonPageModal").on("hidden.bs.modal", function () {
                        trigger.focus();
                    });
                });
            }
        }
        if (this.toggleIsEnabled("LS2531")) {
            const ePriceFormComponent = document.querySelector("do-form-component[form-name='ePrice']");
            //subscribe ePriceModal from FORMSAA so we know when the form is submitted
            //TODO: Get this event name from LEA
            ePriceFormComponent.addEventListener("submit", (e) => {
                if (window.DealeronCookie) {
                    const days = 2;
                    const cookieLife = days * 24 * 60 * 60;
                    window.DealeronCookie.setItem(window.DlronGlobal_PriceUnlocked, '?v=7HWvMx0ytdM', cookieLife);
                    // Let the SRP SPA know that the lead submission was successful
                    document.dispatchEvent(new CustomEvent('trigger-adjust-pricing-visibility'));
                    this.thankYouPopupOpen(e["LeadId"]);
                }
            });
        }
    }
    //this method takes precendence over legacy pricing. If a legacy pricing button
    // ever has these attributes (which is shouldn't), then the legacy config labels
    // will get over written
    trySetModalLabelsByAttribute(button) {
        var _a, _b;
        const ePriceSubmitButton = document.getElementById("ePriceModalSubmitButton");
        const ePriceModalTitle = document.getElementById("ePriceModalTitle");
        const ePriceModalSubtitle = document.getElementById("ePriceModalSubtitle");
        const ePriceModalDefaultDisclaimer = document.getElementById("defaultDisclaimer");
        const ePriceModalEmail = document.getElementById("ePriceModalEmail");
        if (button.dataset.formTitle) {
            ePriceModalTitle.innerHTML = button.dataset.formTitle;
        }
        if (button.dataset.formSubtitle) {
            ePriceModalSubtitle.innerHTML = button.dataset.formSubtitle;
        }
        if (button.dataset.formDisclaimer) {
            ePriceModalDefaultDisclaimer.innerHTML = button.dataset.formDisclaimer;
        }
        if (button.dataset.formButtonLabel && ePriceSubmitButton) {
            ePriceSubmitButton.innerHTML = button.dataset.formButtonLabel;
            ePriceSubmitButton.value = button.dataset.formTitle;
        }
        if (button.dataset.formEmail) {
            ePriceModalEmail.value = button.dataset.formEmail;
        }
        const ePriceModal = document.getElementById("primaryButtonPageModal");
        const ctaName = ePriceModal.querySelector('input[name="ctaName"]');
        if (!ctaName) {
            return;
        }
        // Site speed: if button's only descendant is a plain text node, use innerHTML instead of innerText to avoid recalculating layout. innerText should cover any other cases where the button has actual elements as children.
        if (button.childNodes.length == 1 && button.childNodes[0].nodeType == Node.TEXT_NODE) {
            ctaName.value = (_a = button.innerHTML) === null || _a === void 0 ? void 0 : _a.trim();
        }
        else {
            ctaName.value = (_b = button.innerText) === null || _b === void 0 ? void 0 : _b.trim();
        }
    }
    //note: listen for do-form-component events to be fired from the form component
    setupPrimaryButtonPageModal(e) {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3, _4, _5, _6, _7, _8, _9, _10, _11, _12, _13, _14, _15, _16, _17, _18, _19, _20, _21, _22, _23, _24, _25, _26, _27, _28, _29, _30, _31, _32, _33, _34, _35, _36, _37, _38, _39, _40, _41, _42, _43, _44, _45, _46, _47, _48, _49, _50, _51, _52, _53, _54, _55, _56, _57, _58;
        const modalElem = document.getElementById("primaryButtonPageModal");
        const btnData = e.currentTarget;
        const mode = btnData.getAttribute('data-mode');
        this._mostRecentMode = mode;
        //NOTE: These are defaults, but any data attributes on the price stack button
        //          that have values will override these in the 'shown.bs.modal' event
        const currentConfig = this._buttonConfig.buttons.find(x => x.name == mode);
        if (currentConfig) {
            const ePriceSubmitButton = document.getElementById("ePriceModalSubmitButton");
            const ePriceModalTitle = document.getElementById("ePriceModalTitle");
            const ePriceModalSubtitle = document.getElementById("ePriceModalSubtitle");
            if (ePriceSubmitButton) {
                ePriceSubmitButton.innerHTML = currentConfig.label;
                ePriceSubmitButton.value = currentConfig.label;
            }
            ePriceModalTitle.innerHTML = currentConfig.title;
            ePriceModalSubtitle.innerHTML = currentConfig.comments;
        }
        else {
            console.warn(`Unsupported EPriceModal mode ${mode}`);
        }
        const name = btnData.getAttribute('data-name');
        const vin = btnData.getAttribute('data-vin');
        const color = btnData.getAttribute('data-color');
        const stock = btnData.getAttribute('data-stock');
        let photo = "";
        const photoUrl = btnData.getAttribute('data-photo');
        if (photoUrl && photoUrl.length > 0 && photoUrl.charAt(0) === '/') {
            photo = `${window.location.origin}${photoUrl}`;
        }
        else {
            photo = `${window.location.origin}/${photoUrl}`;
        }
        const vehicleId = btnData.getAttribute('data-vehicleid');
        const year = btnData.getAttribute('data-year');
        const make = btnData.getAttribute('data-make');
        const model = btnData.getAttribute('data-model');
        const trim = btnData.getAttribute('data-trim');
        const location = btnData.getAttribute('data-altdealerlocation');
        const type = btnData.getAttribute('data-type');
        const taggingParentElement = document.querySelector(`[data-dotagging-item-id="${vin !== null && vin !== void 0 ? vin : ""}"]`);
        this._mostRecentCPO = btnData.getAttribute('data-cpo');
        this._vehicleModelCode = btnData.getAttribute('data-modelcd');
        //DEV-23638: Only send DigitalGarage leads for new vehicles
        if (this._settings.isDigitalGarageEnabled && this._settings.pageIsNew) {
            const dgDataHub = window.DGDataHub;
            const dgId = dgDataHub ? dgDataHub.getDgid() : "";
            window.DealeronLead.thirdPartyJsonAdapter.setData({ 'dg_dgid': dgId, 'dg_modelCd': btnData.getAttribute('data-modelcd') });
        }
        //TODO: Remove this when LS2531 is removed from the codebase
        if (!this.toggleIsEnabled("LS2531")) {
            document.querySelectorAll('.ePriceComments').forEach((item) => {
                item.innerHTML = item.innerHTML.replace('#VEHICLE#', name);
            });
            document.getElementById('eprice_vehId').innerHTML = vehicleId;
            document.getElementById('eprice_vehType').innerHTML = type;
            // The rest of the eprice_veh elements aren't rendered on VdpVirtual
            if (((_a = this._settings.vehicleType) === null || _a === void 0 ? void 0 : _a.toLowerCase()) !== "virtual") {
                document.getElementById('eprice_vehName').innerHTML = '<b>' + name + '</b>';
                const vinElemLabel = modalElem === null || modalElem === void 0 ? void 0 : modalElem.querySelector('.vehVin');
                const vinElem = document.getElementById('eprice_vehVin');
                if (vinElem) {
                    if (vin !== "") {
                        vinElem.innerHTML = vin;
                        vinElem.classList.remove("hidden");
                        vinElemLabel === null || vinElemLabel === void 0 ? void 0 : vinElemLabel.classList.remove("hidden");
                    }
                    else {
                        vinElem.classList.add("hidden");
                        vinElemLabel === null || vinElemLabel === void 0 ? void 0 : vinElemLabel.classList.add("hidden");
                    }
                }
                const colorElemLabel = modalElem === null || modalElem === void 0 ? void 0 : modalElem.querySelector('.vehColor');
                const colorElem = document.getElementById('eprice_vehColor');
                if (colorElem) {
                    if (color !== "") {
                        colorElem.innerHTML = color;
                        colorElem.classList.remove("hidden");
                        colorElemLabel === null || colorElemLabel === void 0 ? void 0 : colorElemLabel.classList.remove("hidden");
                    }
                    else {
                        colorElem.classList.add("hidden");
                        colorElemLabel === null || colorElemLabel === void 0 ? void 0 : colorElemLabel.classList.add("hidden");
                    }
                }
                const stockElemLabel = modalElem === null || modalElem === void 0 ? void 0 : modalElem.querySelector('.vehStock');
                const stockElem = document.getElementById('eprice_vehStock');
                if (stockElem) {
                    if (stock !== "") {
                        stockElem.innerHTML = stock;
                        stockElem.classList.remove("hidden");
                        stockElemLabel === null || stockElemLabel === void 0 ? void 0 : stockElemLabel.classList.remove("hidden");
                    }
                    else {
                        stockElem.classList.add("hidden");
                        stockElemLabel === null || stockElemLabel === void 0 ? void 0 : stockElemLabel.classList.add("hidden");
                    }
                }
                document.getElementById('eprice_vehYear').innerHTML = year;
                document.getElementById('eprice_vehMake').innerHTML = make;
                document.getElementById('eprice_vehModel').innerHTML = model;
                document.getElementById('eprice_vehTrim').innerHTML = trim;
                document.getElementById('eprice_vehLocation').innerHTML = location;
                document.getElementById('eprice_vehIsCpo').innerHTML = this._mostRecentCPO;
                //DEV-24403: Add the img after the modal renders to avoid ADA violations
                document.getElementById('epriceImage').innerHTML = `<img id="eprice_photo" class="img-responsive" alt="${name}" src="${photo}" />`;
            }
            // Added to be able to find the srpVehicle element with all vehicle data on it
            const form = document.getElementById('epriceForm');
            form.setAttribute('data-vin', vin);
            // set leadsource element value
            (_b = document.getElementById('eprice_leadSource')) === null || _b === void 0 ? void 0 : _b.setAttribute('value', this.getLeadSource());
            // DO-21595
            if ((_c = taggingParentElement === null || taggingParentElement === void 0 ? void 0 : taggingParentElement.hasAttributes()) !== null && _c !== void 0 ? _c : false) {
                form.setAttribute('data-dotagging-item-id', vin);
                form.setAttribute('data-dotagging-item-number', (_f = (_e = (_d = taggingParentElement.attributes) === null || _d === void 0 ? void 0 : _d.getNamedItem('data-dotagging-item-number')) === null || _e === void 0 ? void 0 : _e.value) !== null && _f !== void 0 ? _f : '');
                form.setAttribute('data-dotagging-item-price', (_j = (_h = (_g = taggingParentElement.attributes) === null || _g === void 0 ? void 0 : _g.getNamedItem('data-dotagging-item-price')) === null || _h === void 0 ? void 0 : _h.value) !== null && _j !== void 0 ? _j : '');
                form.setAttribute('data-dotagging-item-condition', (_m = (_l = (_k = taggingParentElement.attributes) === null || _k === void 0 ? void 0 : _k.getNamedItem('data-dotagging-item-condition')) === null || _l === void 0 ? void 0 : _l.value) !== null && _m !== void 0 ? _m : '');
                form.setAttribute('data-dotagging-item-year', (_q = (_p = (_o = taggingParentElement.attributes) === null || _o === void 0 ? void 0 : _o.getNamedItem('data-dotagging-item-year')) === null || _p === void 0 ? void 0 : _p.value) !== null && _q !== void 0 ? _q : '');
                form.setAttribute('data-dotagging-item-make', (_t = (_s = (_r = taggingParentElement.attributes) === null || _r === void 0 ? void 0 : _r.getNamedItem('data-dotagging-item-make')) === null || _s === void 0 ? void 0 : _s.value) !== null && _t !== void 0 ? _t : '');
                form.setAttribute('data-dotagging-item-model', (_w = (_v = (_u = taggingParentElement.attributes) === null || _u === void 0 ? void 0 : _u.getNamedItem('data-dotagging-item-model')) === null || _v === void 0 ? void 0 : _v.value) !== null && _w !== void 0 ? _w : '');
                form.setAttribute('data-dotagging-item-variant', (_z = (_y = (_x = taggingParentElement.attributes) === null || _x === void 0 ? void 0 : _x.getNamedItem('data-dotagging-item-variant')) === null || _y === void 0 ? void 0 : _y.value) !== null && _z !== void 0 ? _z : '');
                form.setAttribute('data-dotagging-item-color', (_2 = (_1 = (_0 = taggingParentElement.attributes) === null || _0 === void 0 ? void 0 : _0.getNamedItem('data-dotagging-item-color')) === null || _1 === void 0 ? void 0 : _1.value) !== null && _2 !== void 0 ? _2 : '');
                form.setAttribute('data-dotagging-item-category', (_5 = (_4 = (_3 = taggingParentElement.attributes) === null || _3 === void 0 ? void 0 : _3.getNamedItem('data-dotagging-item-category')) === null || _4 === void 0 ? void 0 : _4.value) !== null && _5 !== void 0 ? _5 : '');
                form.setAttribute('data-dotagging-item-fuel-type', (_8 = (_7 = (_6 = taggingParentElement.attributes) === null || _6 === void 0 ? void 0 : _6.getNamedItem('data-dotagging-item-fuel-type')) === null || _7 === void 0 ? void 0 : _7.value) !== null && _8 !== void 0 ? _8 : '');
                form.setAttribute('data-dotagging-item-type', (_11 = (_10 = (_9 = taggingParentElement.attributes) === null || _9 === void 0 ? void 0 : _9.getNamedItem('data-dotagging-item-type')) === null || _10 === void 0 ? void 0 : _10.value) !== null && _11 !== void 0 ? _11 : '');
                form.setAttribute('data-dotagging-item-inventory-date', (_14 = (_13 = (_12 = taggingParentElement.attributes) === null || _12 === void 0 ? void 0 : _12.getNamedItem('data-dotagging-item-inventory-date')) === null || _13 === void 0 ? void 0 : _13.value) !== null && _14 !== void 0 ? _14 : '');
                form.setAttribute('data-dotagging-item-recommended', (_17 = (_16 = (_15 = taggingParentElement.attributes) === null || _15 === void 0 ? void 0 : _15.getNamedItem('data-dotagging-item-recommended')) === null || _16 === void 0 ? void 0 : _16.value) !== null && _17 !== void 0 ? _17 : '');
                if (this.toggleIsEnabled("NextgenDomUpdate_DO47714")) {
                    form.dataset.dotaggingItemBodyType = (taggingParentElement === null || taggingParentElement === void 0 ? void 0 : taggingParentElement.dataset.dotaggingItemBodyType) || '';
                    form.dataset.dotaggingItemColorInterior = (taggingParentElement === null || taggingParentElement === void 0 ? void 0 : taggingParentElement.dataset.dotaggingItemColorInterior) || '';
                    form.dataset.dotaggingItemEngine = (taggingParentElement === null || taggingParentElement === void 0 ? void 0 : taggingParentElement.dataset.dotaggingItemEngine) || '';
                    form.dataset.dotaggingItemFuelEfficiencyCity = (taggingParentElement === null || taggingParentElement === void 0 ? void 0 : taggingParentElement.dataset.dotaggingItemFuelEfficiencyCity) || '';
                    form.dataset.dotaggingItemFuelEfficiencyHighway = (taggingParentElement === null || taggingParentElement === void 0 ? void 0 : taggingParentElement.dataset.dotaggingItemFuelEfficiencyHighway) || '';
                    form.dataset.dotaggingItemOdometer = (taggingParentElement === null || taggingParentElement === void 0 ? void 0 : taggingParentElement.dataset.dotaggingItemOdometer) || '';
                    form.dataset.dotaggingItemTransmission = (taggingParentElement === null || taggingParentElement === void 0 ? void 0 : taggingParentElement.dataset.dotaggingItemTransmission) || '';
                }
            }
            //Modal opening is done here instead of wih data-toggle and data-target attributes to account for slow connections (see DEV-12380)
            window.jQuery('#primaryButtonPageModal').modal("show", btnData);
            //clear form
            if (modalElem) {
                modalElem.removeAttribute('aria-hidden');
                // When reseting the form, do not set checkbox values to an empty string (allowing them to send a boolean if checked)
                modalElem.querySelectorAll("input:not([type='hidden']):not([type='checkbox'])").forEach((elem) => elem.value = "");
                modalElem.querySelectorAll("textarea").forEach((elem) => elem.value = "");
                modalElem.querySelectorAll(".has-error").forEach((elem) => {
                    if (elem.nodeName.toLocaleLowerCase() === "label") {
                        elem.parentElement.removeChild(elem);
                    }
                    else {
                        elem.classList.remove('has-error');
                    }
                });
                modalElem.querySelectorAll('.has-success').forEach((elem) => elem.classList.remove('has-success'));
            }
            window.ResetTracker();
        }
        if (this.toggleIsEnabled("LS2531")) {
            //Set vehicle data that is above the form
            if (((_18 = this._settings.vehicleType) === null || _18 === void 0 ? void 0 : _18.toLowerCase()) !== "virtual") {
                document.getElementById('eprice_vehName').innerHTML = '<b>' + name + '</b>';
                const vinElemLabel = modalElem === null || modalElem === void 0 ? void 0 : modalElem.querySelector('.vehVin');
                const vinElem = document.getElementById('eprice_vehVin');
                if (vinElem) {
                    if (vin !== "") {
                        vinElem.innerHTML = vin;
                        vinElem.classList.remove("hidden");
                        vinElemLabel === null || vinElemLabel === void 0 ? void 0 : vinElemLabel.classList.remove("hidden");
                    }
                    else {
                        vinElem.classList.add("hidden");
                        vinElemLabel === null || vinElemLabel === void 0 ? void 0 : vinElemLabel.classList.add("hidden");
                    }
                }
                const colorElemLabel = modalElem === null || modalElem === void 0 ? void 0 : modalElem.querySelector('.vehColor');
                const colorElem = document.getElementById('eprice_vehColor');
                if (colorElem) {
                    if (color !== "") {
                        colorElem.innerHTML = color;
                        colorElem.classList.remove("hidden");
                        colorElemLabel === null || colorElemLabel === void 0 ? void 0 : colorElemLabel.classList.remove("hidden");
                    }
                    else {
                        colorElem.classList.add("hidden");
                        colorElemLabel === null || colorElemLabel === void 0 ? void 0 : colorElemLabel.classList.add("hidden");
                    }
                }
                const stockElemLabel = modalElem === null || modalElem === void 0 ? void 0 : modalElem.querySelector('.vehStock');
                const stockElem = document.getElementById('eprice_vehStock');
                if (stockElem) {
                    if (stock !== "") {
                        stockElem.innerHTML = stock;
                        stockElem.classList.remove("hidden");
                        stockElemLabel === null || stockElemLabel === void 0 ? void 0 : stockElemLabel.classList.remove("hidden");
                    }
                    else {
                        stockElem.classList.add("hidden");
                        stockElemLabel === null || stockElemLabel === void 0 ? void 0 : stockElemLabel.classList.add("hidden");
                    }
                }
                //DEV-24403: Add the img after the modal renders to avoid ADA violations
                document.getElementById('epriceImage').innerHTML = `<img id="eprice_photo" class="img-responsive" alt="${name}" src="${photo}" />`;
            }
            //Find the FORMSAA webcomponent for ePriceModalForm
            const ePriceFormComponent = document.querySelector("do-form-component[form-name='ePrice']");
            //Assign attributes to the webcomponent for ePriceModalForm
            if (ePriceFormComponent) {
                ePriceFormComponent.setAttribute("vehicle-vin", vin);
                ePriceFormComponent.setAttribute("vehicle-name", vin);
                ePriceFormComponent.setAttribute("vehicle-stock", stock);
                ePriceFormComponent.setAttribute("vehicle-color", color);
                ePriceFormComponent.setAttribute("vehicle-year", year);
                ePriceFormComponent.setAttribute("vehicle-make", make);
                ePriceFormComponent.setAttribute("vehicle-model", model);
                ePriceFormComponent.setAttribute("vehicle-trim", trim);
                ePriceFormComponent.setAttribute("vehicle-location", location);
                ePriceFormComponent.setAttribute("vehicle-type", type);
                ePriceFormComponent.setAttribute("vehicle-cpo", this._mostRecentCPO);
                ePriceFormComponent.setAttribute("vehicle-modelcd", this._vehicleModelCode);
                //assign tagging data to the webcomponent for ePriceModalForm
                if ((_19 = taggingParentElement === null || taggingParentElement === void 0 ? void 0 : taggingParentElement.hasAttributes()) !== null && _19 !== void 0 ? _19 : false) {
                    ePriceFormComponent.setAttribute('data-dotagging-item-id', vin);
                    ePriceFormComponent.setAttribute('data-dotagging-item-number', (_22 = (_21 = (_20 = taggingParentElement.attributes) === null || _20 === void 0 ? void 0 : _20.getNamedItem('data-dotagging-item-number')) === null || _21 === void 0 ? void 0 : _21.value) !== null && _22 !== void 0 ? _22 : '');
                    ePriceFormComponent.setAttribute('data-dotagging-item-price', (_25 = (_24 = (_23 = taggingParentElement.attributes) === null || _23 === void 0 ? void 0 : _23.getNamedItem('data-dotagging-item-price')) === null || _24 === void 0 ? void 0 : _24.value) !== null && _25 !== void 0 ? _25 : '');
                    ePriceFormComponent.setAttribute('data-dotagging-item-condition', (_28 = (_27 = (_26 = taggingParentElement.attributes) === null || _26 === void 0 ? void 0 : _26.getNamedItem('data-dotagging-item-condition')) === null || _27 === void 0 ? void 0 : _27.value) !== null && _28 !== void 0 ? _28 : '');
                    ePriceFormComponent.setAttribute('data-dotagging-item-year', (_31 = (_30 = (_29 = taggingParentElement.attributes) === null || _29 === void 0 ? void 0 : _29.getNamedItem('data-dotagging-item-year')) === null || _30 === void 0 ? void 0 : _30.value) !== null && _31 !== void 0 ? _31 : '');
                    ePriceFormComponent.setAttribute('data-dotagging-item-make', (_34 = (_33 = (_32 = taggingParentElement.attributes) === null || _32 === void 0 ? void 0 : _32.getNamedItem('data-dotagging-item-make')) === null || _33 === void 0 ? void 0 : _33.value) !== null && _34 !== void 0 ? _34 : '');
                    ePriceFormComponent.setAttribute('data-dotagging-item-model', (_37 = (_36 = (_35 = taggingParentElement.attributes) === null || _35 === void 0 ? void 0 : _35.getNamedItem('data-dotagging-item-model')) === null || _36 === void 0 ? void 0 : _36.value) !== null && _37 !== void 0 ? _37 : '');
                    ePriceFormComponent.setAttribute('data-dotagging-item-variant', (_40 = (_39 = (_38 = taggingParentElement.attributes) === null || _38 === void 0 ? void 0 : _38.getNamedItem('data-dotagging-item-variant')) === null || _39 === void 0 ? void 0 : _39.value) !== null && _40 !== void 0 ? _40 : '');
                    ePriceFormComponent.setAttribute('data-dotagging-item-color', (_43 = (_42 = (_41 = taggingParentElement.attributes) === null || _41 === void 0 ? void 0 : _41.getNamedItem('data-dotagging-item-color')) === null || _42 === void 0 ? void 0 : _42.value) !== null && _43 !== void 0 ? _43 : '');
                    ePriceFormComponent.setAttribute('data-dotagging-item-category', (_46 = (_45 = (_44 = taggingParentElement.attributes) === null || _44 === void 0 ? void 0 : _44.getNamedItem('data-dotagging-item-category')) === null || _45 === void 0 ? void 0 : _45.value) !== null && _46 !== void 0 ? _46 : '');
                    ePriceFormComponent.setAttribute('data-dotagging-item-fuel-type', (_49 = (_48 = (_47 = taggingParentElement.attributes) === null || _47 === void 0 ? void 0 : _47.getNamedItem('data-dotagging-item-fuel-type')) === null || _48 === void 0 ? void 0 : _48.value) !== null && _49 !== void 0 ? _49 : '');
                    ePriceFormComponent.setAttribute('data-dotagging-item-type', (_52 = (_51 = (_50 = taggingParentElement.attributes) === null || _50 === void 0 ? void 0 : _50.getNamedItem('data-dotagging-item-type')) === null || _51 === void 0 ? void 0 : _51.value) !== null && _52 !== void 0 ? _52 : '');
                    ePriceFormComponent.setAttribute('data-dotagging-item-inventory-date', (_55 = (_54 = (_53 = taggingParentElement.attributes) === null || _53 === void 0 ? void 0 : _53.getNamedItem('data-dotagging-item-inventory-date')) === null || _54 === void 0 ? void 0 : _54.value) !== null && _55 !== void 0 ? _55 : '');
                    ePriceFormComponent.setAttribute('data-dotagging-item-recommended', (_58 = (_57 = (_56 = taggingParentElement.attributes) === null || _56 === void 0 ? void 0 : _56.getNamedItem('data-dotagging-item-recommended')) === null || _57 === void 0 ? void 0 : _57.value) !== null && _58 !== void 0 ? _58 : '');
                    if (this.toggleIsEnabled("NextgenDomUpdate_DO47714")) {
                        ePriceFormComponent.dataset.dotaggingItemBodyType = (taggingParentElement === null || taggingParentElement === void 0 ? void 0 : taggingParentElement.dataset.dotaggingItemBodyType) || '';
                        ePriceFormComponent.dataset.dotaggingItemColorInterior = (taggingParentElement === null || taggingParentElement === void 0 ? void 0 : taggingParentElement.dataset.dotaggingItemColorInterior) || '';
                        ePriceFormComponent.dataset.dotaggingItemEngine = (taggingParentElement === null || taggingParentElement === void 0 ? void 0 : taggingParentElement.dataset.dotaggingItemEngine) || '';
                        ePriceFormComponent.dataset.dotaggingItemFuelEfficiencyCity = (taggingParentElement === null || taggingParentElement === void 0 ? void 0 : taggingParentElement.dataset.dotaggingItemFuelEfficiencyCity) || '';
                        ePriceFormComponent.dataset.dotaggingItemFuelEfficiencyHighway = (taggingParentElement === null || taggingParentElement === void 0 ? void 0 : taggingParentElement.dataset.dotaggingItemFuelEfficiencyHighway) || '';
                        ePriceFormComponent.dataset.dotaggingItemOdometer = (taggingParentElement === null || taggingParentElement === void 0 ? void 0 : taggingParentElement.dataset.dotaggingItemOdometer) || '';
                        ePriceFormComponent.dataset.dotaggingItemTransmission = (taggingParentElement === null || taggingParentElement === void 0 ? void 0 : taggingParentElement.dataset.dotaggingItemTransmission) || '';
                    }
                }
            }
            //Open the ePriceModal
            window.jQuery('#primaryButtonPageModal').modal("show", btnData);
        }
    }
    ePriceSuccessCallback(data) {
        let days = 2;
        let cookieLife = days * 24 * 60 * 60;
        //Dealeron Cookie
        if (window.DealeronCookie) {
            window.DealeronCookie.setItem(window.DlronGlobal_PriceUnlocked, '?v=7HWvMx0ytdM', cookieLife);
            // Let the SRP SPA know that the lead submission was successful
            document.dispatchEvent(new CustomEvent('trigger-adjust-pricing-visibility'));
            var eventValue;
            var response = JSON.parse(data);
            window.DealeronLead.thirdPartyJsonAdapter.reset();
            if (typeof (window.DealeronCookie) == 'object') {
                var dataString = "";
                if (response.hasOwnProperty('internalId')) {
                    dataString += "InternalId=" + response["internalId"] + "|";
                }
                var daysToKeep = 30 * 60; // 30 minutes converted to seconds
                window.DealeronCookie.setItem(window.DlronGlobal_DealeronLeadResponseCookieName, dataString, daysToKeep);
            }
            const thankyouIframe = document.getElementById('thankyou-iframe');
            thankyouIframe.addEventListener("load", function () {
                const innerIframe = thankyouIframe.contentDocument || thankyouIframe.contentWindow.document;
                // remove header and footer
                var header = innerIframe.getElementsByClassName('headerWrapper')[0];
                var footer = innerIframe.getElementsByTagName('footer')[0];
                if (header) {
                    header.remove();
                }
                if (footer) {
                    footer.remove();
                }
                // set links to open in parent page
                var links = innerIframe.getElementsByTagName('a');
                for (var i = 0; i < links.length; i++) {
                    links[i].setAttribute('target', '_parent');
                }
                // update display
                document.getElementById('thankyou-popup').style.display = 'block';
                document.getElementById('eprice-main-content').style.display = 'none';
            });
            thankyouIframe.src = "/thankyou.aspx?modal=true&lid=" + response.leadId;
        }
    }
    thankYouPopupOpen(leadId) {
        const thankyouIframe = document.getElementById('thankyou-iframe');
        thankyouIframe.addEventListener("load", function () {
            const innerIframe = thankyouIframe.contentDocument || thankyouIframe.contentWindow.document;
            // remove header and footer
            var header = innerIframe.getElementsByClassName('headerWrapper')[0];
            var footer = innerIframe.getElementsByTagName('footer')[0];
            if (header) {
                header.remove();
            }
            if (footer) {
                footer.remove();
            }
            // set links to open in parent page
            var links = innerIframe.getElementsByTagName('a');
            for (var i = 0; i < links.length; i++) {
                links[i].setAttribute('target', '_parent');
            }
            // update display
            document.getElementById('thankyou-popup').style.display = 'block';
            document.getElementById('eprice-main-content').style.display = 'none';
        });
        thankyouIframe.src = "/thankyou.aspx?modal=true&lid=" + leadId;
    }
    getReserveThisVehicleLeadSource(page, vehicle) {
        if (vehicle.type === 'n') {
            return (page.isMobile) ? this._settings.leadSource.MobileReserveVehicleNew.Id : this._settings.leadSource.ReserveVehicleNew.Id;
        }
        else if (vehicle.type === 'u') {
            return (page.isMobile) ? this._settings.leadSource.MobileReserveVehicleUsed.Id : this._settings.leadSource.ReserveVehicleUsed.Id;
        }
        else {
            /* Reservice this vehicle catchLeadSource */
            if (page.isNew) {
                return (page.isMobile) ? this._settings.leadSource.MobileReserveVehicleNew.Id : this._settings.leadSource.ReserveVehicleNew.Id;
            }
            else {
                return (page.isMobile) ? this._settings.leadSource.MobileReserveVehicleUsed.Id : this._settings.leadSource.ReserveVehicleUsed.Id;
            }
        }
    }
    getPriceDropAndTrackAlertLeadSource(page, vehicle) {
        var _a, _b, _c;
        const vehicleType = ((_a = vehicle.type) !== null && _a !== void 0 ? _a : '').toLowerCase();
        const isUsed = vehicleType === 'u' || vehicleType === 'used';
        const isNew = vehicleType === 'n' || vehicleType === 'new';
        let normalizedType = null;
        if (isNew) {
            normalizedType = 'n';
        }
        else if (isUsed) {
            normalizedType = 'u';
        }
        const leadSourceMap = {
            n: {
                vdp: {
                    mobile: this._settings.leadSource.MobilePriceDropAlertNew.Id,
                    desktop: this._settings.leadSource.PriceDropAlertNew.Id
                },
                srp: {
                    mobile: this._settings.leadSource.MobilePriceDropAlertNewSRP.Id,
                    desktop: this._settings.leadSource.PriceDropAlertNewSRP.Id
                }
            },
            u: {
                vdp: {
                    mobile: this._settings.leadSource.MobilePriceDropAlertUsed.Id,
                    desktop: this._settings.leadSource.PriceDropAlertUsed.Id
                },
                srp: {
                    mobile: this._settings.leadSource.MobilePriceDropAlertUsedSRP.Id,
                    desktop: this._settings.leadSource.PriceDropAlertUsedSRP.Id
                }
            }
        };
        const getPageType = (page) => {
            if (page.isVdp)
                return 'vdp';
            if (page.isSrp)
                return 'srp';
            return 'other';
        };
        const pageType = getPageType(page);
        const device = page.isMobile ? 'mobile' : 'desktop';
        if (normalizedType && pageType !== 'other' && ((_c = (_b = leadSourceMap[normalizedType]) === null || _b === void 0 ? void 0 : _b[pageType]) === null || _c === void 0 ? void 0 : _c[device])) {
            return leadSourceMap[normalizedType][pageType][device];
        }
        const fallbackType = page.isNew ? 'n' : 'u';
        return leadSourceMap[fallbackType]['vdp'][device];
    }
    getGetSalePriceLeadSource(page, vehicle) {
        if (vehicle.type === 'n') {
            return (page.isMobile) ? this._settings.leadSource.MobileGetSalePriceVdpNew.Id : this._settings.leadSource.GetSalePriceVdpNew.Id;
        }
        else if (vehicle.type === 'u') {
            return (page.isMobile) ? this._settings.leadSource.MobileGetSalePriceVdpUsed.Id : this._settings.leadSource.GetSalePriceVdpUsed.Id;
        }
        else {
            /* Get Sale Price catchLeadSource */
            if (page.isNew) {
                return (page.isMobile) ? this._settings.leadSource.MobileGetSalePriceVdpNew.Id : this._settings.leadSource.GetSalePriceVdpNew.Id;
            }
            else {
                return (page.isMobile) ? this._settings.leadSource.MobileGetSalePriceVdpUsed.Id : this._settings.leadSource.GetSalePriceVdpUsed.Id;
            }
        }
    }
    getConfirmAvailabilityLeadSource(page, vehicle) {
        if (vehicle.type === 'n') {
            return (page.isMobile) ? this._settings.leadSource.MobileConfirmAvailabilityVdpNew.Id : this._settings.leadSource.ConfirmAvailabilityVdpNew.Id;
        }
        else if (vehicle.type === 'u') {
            return (page.isMobile) ? this._settings.leadSource.MobileConfirmAvailabilityVdpUsed.Id : this._settings.leadSource.ConfirmAvailabilityVdpUsed.Id;
        }
        else {
            /* Confirm Availability catchLeadSource */
            if (page.isNew) {
                return (page.isMobile) ? this._settings.leadSource.MobileConfirmAvailabilityVdpNew.Id : this._settings.leadSource.ConfirmAvailabilityVdpNew.Id;
            }
            else {
                return (page.isMobile) ? this._settings.leadSource.MobileConfirmAvailabilityVdpUsed.Id : this._settings.leadSource.ConfirmAvailabilityVdpUsed.Id;
            }
        }
    }
    getPriceStakPaymentsLeadSource(page, vehicle) {
        if (vehicle.type === 'n') {
            if (page.isVdp) {
                return (page.isMobile) ? this._settings.leadSource.MobilePriceStakDetailsNew.Id : this._settings.leadSource.PriceStakDetailsNew.Id;
            }
            else {
                return (page.isMobile) ? this._settings.leadSource.MobilePriceStakInventoryNew.Id : this._settings.leadSource.PriceStakInventoryNew.Id;
            }
        }
        else if (vehicle.type === 'u') {
            if (page.isVdp) {
                return (page.isMobile) ? this._settings.leadSource.MobilePriceStakDetailsUsed.Id : this._settings.leadSource.PriceStakDetailsUsed.Id;
            }
            else {
                return (page.isMobile) ? this._settings.leadSource.MobilePriceStakInventoryUsed.Id : this._settings.leadSource.PriceStakInventoryUsed.Id;
            }
        }
        else {
            /*PriceStak Payment catchLeadSource */
            if (page.isNew) {
                if (page.isVdp) {
                    return (page.isMobile) ? this._settings.leadSource.MobilePriceStakDetailsNew.Id : this._settings.leadSource.PriceStakDetailsNew.Id;
                }
                else {
                    return (page.isMobile) ? this._settings.leadSource.MobilePriceStakInventoryNew.Id : this._settings.leadSource.PriceStakInventoryNew.Id;
                }
            }
            else {
                if (page.isVdp) {
                    return (page.isMobile) ? this._settings.leadSource.MobilePriceStakDetailsUsed.Id : this._settings.leadSource.PriceStakDetailsUsed.Id;
                }
                else {
                    return (page.isMobile) ? this._settings.leadSource.MobilePriceStakInventoryUsed.Id : this._settings.leadSource.PriceStakInventoryUsed.Id;
                }
            }
        }
    }
    getVdpLeadSource(page, vehicle) {
        if (vehicle.type === 'u') {
            if (page.isMobile) {
                return this._settings.leadSource.MobileEPriceDetailsUsed.Id;
            }
            else if (vehicle.isCpo()) {
                return this._settings.leadSource.VehicleCertified.Id;
            }
            else {
                return this._settings.leadSource.EPriceDetailsUsed.Id;
            }
        }
        else if (vehicle.type === 'n') {
            return (page.isMobile) ? this._settings.leadSource.MobileEPriceDetailsNew.Id : this._settings.leadSource.EPriceDetailsNew.Id;
        }
        else {
            return this.catchLeadSource(page, vehicle);
        }
    }
    getSrpLeadSource(page, vehicle) {
        if (vehicle.type === 'n') {
            return (page.isMobile) ? this._settings.leadSource.MobileEPriceInventoryNew.Id : this._settings.leadSource.EPriceInventoryNew.Id;
        }
        else if (vehicle.type === 'u') {
            if (page.isMobile) {
                return this._settings.leadSource.MobileEPriceInventoryUsed.Id;
            }
            else if (vehicle.isCpo()) {
                return this._settings.leadSource.VehicleCertified.Id;
            }
            else {
                return this._settings.leadSource.EPriceInventoryUsed.Id;
            }
        }
        else {
            return this.catchLeadSource(page, vehicle);
        }
    }
    getMrpLeadSource(page, vehicle) {
        if (vehicle.type === 'n') {
            return (page.isMobile) ? this._settings.leadSource.MobileEPriceModelResearchNew.Id : this._settings.leadSource.EPriceModelResearchNew.Id;
        }
        else {
            return this.catchLeadSource(page, vehicle);
        }
    }
    catchLeadSource(page, vehicle) {
        if (page.isVdp) {
            if (page.isNew) {
                return (page.isMobile) ? this._settings.leadSource.MobileEPriceDetailsNew.Id : this._settings.leadSource.EPriceDetailsNew.Id;
            }
            else {
                if (page.isMobile) {
                    return this._settings.leadSource.MobileEPriceDetailsUsed.Id;
                }
                else if (vehicle.isCpo()) {
                    return this._settings.leadSource.VehicleCertified.Id;
                }
                else {
                    return this._settings.leadSource.EPriceDetailsUsed.Id;
                }
            }
        }
        else if (page.isMrp) {
            return (page.isMobile) ? this._settings.leadSource.MobileEPriceModelResearchNew.Id : this._settings.leadSource.EPriceModelResearchNew.Id;
        }
        else {
            if (page.isNew) {
                return (page.isMobile) ? this._settings.leadSource.MobileEPriceInventoryNew.Id : this._settings.leadSource.EPriceInventoryNew.Id;
            }
            else {
                if (page.isMobile) {
                    return this._settings.leadSource.MobileEPriceInventoryUsed.Id;
                }
                else if (vehicle.isCpo()) {
                    return this._settings.leadSource.VehicleCertified.Id;
                }
                else {
                    return this._settings.leadSource.EPriceInventoryUsed.Id;
                }
            }
        }
    }
    setupOneTimeLeadEvents() {
        const ePriceModal = document.querySelector('#primaryButtonPageModal');
        const formInputs = ePriceModal === null || ePriceModal === void 0 ? void 0 : ePriceModal.querySelectorAll("input, textarea, select");
        formInputs.forEach((input) => {
            input.addEventListener("focusout", this.trackerHookListener, false);
        });
    }
    teardownOneTimeLeadEvents() {
        //remove the trackerHookListener because we only want to instantiate this one time
        const ePriceModal = document.querySelector('#primaryButtonPageModal');
        const formInputs = ePriceModal === null || ePriceModal === void 0 ? void 0 : ePriceModal.querySelectorAll("input, textarea, select");
        formInputs.forEach((input) => {
            input.removeEventListener("focusout", this.trackerHookListener, false);
        });
    }
    getLeadJsContent() {
        var _a, _b;
        window.DealeronLead.addSubmissionMethod('sendePriceSubmit', {
            leadSource: this.getLeadSource,
            leadType: this.getLeadType,
            additionalData: this.ePriceData,
            successCallback: this.ePriceSuccessCallback
        });
        window.DealeronLead.initialize('#epriceForm', 'sendePriceSubmit');
        if (this._settings.trackerType === "Scion") {
            const year = document.getElementById('eprice_vehYear').innerHTML;
            const model = document.getElementById('eprice_vehModel').innerHTML;
            const tmsomniTracker = window.tmsomni;
            if (tmsomniTracker) {
                tmsomniTracker.prop2 = year;
                tmsomniTracker.eVar2 = year;
                tmsomniTracker.prop9 = model;
                tmsomniTracker.eVar9 = model;
                tmsomniTracker.prop10 = `${(_a = this._settings.vehicleType) === null || _a === void 0 ? void 0 : _a.toLowerCase()}`;
                tmsomniTracker.eVar16 = `${(_b = this._settings.vehicleType) === null || _b === void 0 ? void 0 : _b.toLowerCase()}`;
            }
        }
        window.ResetTracker();
        this.ePriceData();
    }
    trackerHookListener() {
        window.DealeronLead.begin();
        window.ResetTracker();
        window.trackerHook({ trackId: this.getLeadSource });
        window.ePriceModal.teardownOneTimeLeadEvents();
    }
    getLocalStorageToggles() {
        const storageLocation = "sessionToggles_" + window.DlronGlobal_DealerId;
        try {
            const toggleString = sessionStorage.getItem(storageLocation);
            return JSON.parse(toggleString);
        }
        catch (error) {
            console.error("Error parsing sessionStorage:", error);
            return {};
        }
    }
    isToggleQueryParamOn(key) {
        const params = new URLSearchParams(window.location.search);
        const value = params.get(key);
        if (value === 'on')
            return true;
        if (value === 'off')
            return false;
        return null;
    }
}
instantiateEPriceModal();
function instantiateEPriceModal() {
    return __awaiter(this, void 0, void 0, function* () {
        globalThis.ePriceModal = new EPriceModal();
        const start = () => __awaiter(this, void 0, void 0, function* () {
            globalThis.ePriceModal.init();
            // If not VDP, just run setupEvents immediately and exit
            if (!globalThis.ePriceModal._settings.pageIsVdp) {
                return;
            }
            yield customElements.whenDefined('do-price-track');
            const existing = document.querySelector('do-price-track');
            if (existing) {
                globalThis.ePriceModal.setupEvents();
                return;
            }
            //do-price-track is loading late - use MutationObserver to watch for it
            const root = document.body;
            const observer = new MutationObserver((mutations, obs) => {
                if (document.querySelector('do-price-track')) {
                    globalThis.ePriceModal.setupEvents();
                    obs.disconnect();
                    clearTimeout(timeoutId);
                }
            });
            observer.observe(root, { childList: true, subtree: true });
            const timeoutId = setTimeout(() => observer.disconnect(), 10000);
        });
        if (document.readyState === 'loading') {
            globalThis.addEventListener('DOMContentLoaded', start, { once: true });
        }
        else {
            start();
        }
    });
}

/******/ })()
;